## Подробное описание программы

### Общая цель
Эта программа предназначена для взаимодействия с пользовательским драйвером устройства последовательного порта. Она:
1. Подключается к драйверу через символическую ссылку.
2. Периодически проверяет готовность передатчика с помощью команды IOCTL.
3. Отправляет байт данных в порт, если передатчик готов.

---

### **1. Подключение к устройству**
```c
HANDLE hDevice;

while (true) {
    hDevice = CreateFile(
        "\\\\.\\SerialPortDriver",
        GENERIC_READ | GENERIC_WRITE,
        0,
        NULL,
        OPEN_EXISTING,
        FILE_ATTRIBUTE_NORMAL,
        NULL
    );
```

#### Детали
1. **`CreateFile`**:
   - Открывает символическую ссылку на устройство `\\.\SerialPortDriver`.
   - Параметры:
     - **`GENERIC_READ | GENERIC_WRITE`**: Открывает устройство для чтения и записи.
     - **`OPEN_EXISTING`**: Ожидается, что устройство уже существует.
   - Возвращает дескриптор устройства `hDevice` или `INVALID_HANDLE_VALUE` в случае ошибки.

2. **Цикл подключения**:
   - Если устройство недоступно, программа:
     - Логирует ошибку через `GetLastError`.
     - Ждёт 1 секунду (`Sleep(1000)`).
   - Успешное подключение завершает цикл, выводя сообщение об успехе.

---

### **2. Основной цикл работы**
```c
while (true) {
    BOOL isReady = FALSE;
    DWORD bytesReturned;

    if (DeviceIoControl(
            hDevice,
            IOCTL_CHECK_TRANSMITTER_READY,
            NULL,
            0,
            &isReady,
            sizeof(isReady),
            &bytesReturned,
            NULL
        )) {
```

#### Детали
1. **`DeviceIoControl` для проверки готовности**:
   - Команда: `IOCTL_CHECK_TRANSMITTER_READY`.
   - Параметры:
     - Входных данных нет (`NULL`, `0`).
     - Выходные данные (`&isReady`, `sizeof(isReady)`):
       - Если передатчик готов, `isReady = TRUE`.
       - Если не готов, `isReady = FALSE`.

2. **Обработка результата**:
   - Если команда успешна:
     - При готовности передатчика программа отправляет байт данных.
     - Иначе логирует, что передатчик не готов.

   - Если команда завершилась ошибкой:
     - Выводится сообщение с кодом ошибки.

---

### **3. Отправка байта данных**
```c
CHAR byteToWrite = 'A';
if (DeviceIoControl(
        hDevice,
        IOCTL_WRITE_BYTE_TO_PORT,
        &byteToWrite,
        sizeof(byteToWrite),
        NULL,
        0,
        &bytesReturned,
        NULL
    )) {
```

#### Детали
1. **`DeviceIoControl` для записи данных**:
   - Команда: `IOCTL_WRITE_BYTE_TO_PORT`.
   - Параметры:
     - Входной буфер: `&byteToWrite` (символ для отправки).
     - Размер входного буфера: `sizeof(byteToWrite)` (1 байт).
     - Выходные данные не требуются (`NULL`, `0`).

2. **Обработка результата**:
   - При успешной записи выводится сообщение, что байт записан.
   - При ошибке логируется код ошибки.

---

### **4. Задержка между итерациями**
```c
Sleep(500);
```

#### Детали
- Вводится задержка в 500 миллисекунд между проверками передатчика, чтобы избежать чрезмерной загрузки процессора.

---

### **5. Завершение программы**
```c
CloseHandle(hDevice);
```

#### Детали
- После завершения работы с устройством закрывается дескриптор устройства (`CloseHandle`).

---

### **Основные действия программы**
1. Попытки подключения к драйверу до успешного открытия.
2. Циклическая проверка готовности передатчика:
   - Если передатчик готов, отправляется символ `'A'`.
   - Если передатчик не готов, программа ожидает.
3. Логирование всех операций, включая ошибки.