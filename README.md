### Жизненный цикл драйвера и пользовательского приложения

---

#### **Жизненный цикл драйвера**

1. **Инициализация драйвера** (выполняется при загрузке драйвера):
   - Вызов функции `DriverEntry` операционной системой.
   - Регистрируются функции обработки запросов (`IRP_MJ_CREATE`, `IRP_MJ_CLOSE`, `IRP_MJ_DEVICE_CONTROL`).
   - Создаются устройство (`IoCreateDevice`) и символическая ссылка (`IoCreateSymbolicLink`).
   - Проверяется готовность передатчика (`IsTransmitterReady`), если передатчик не готов, загрузка драйвера завершается с ошибкой.
   - Конфигурируется последовательный порт через `ConfigureSerialPort`.

2. **Создание соединения с устройством**:
   - Обрабатываются запросы на открытие/закрытие устройства с помощью функции `CreateCloseHandler`.

3. **Обработка команд**:
   - Обработка IOCTL-запросов происходит в функции `DeviceIoControlHandler`. Основные запросы:
     - `IOCTL_CHECK_TRANSMITTER_READY`: проверяет, готов ли передатчик, и возвращает результат в пользовательское приложение.
     - `IOCTL_WRITE_BYTE_TO_PORT`: записывает байт в порт, если передатчик готов.

4. **Завершение работы драйвера**:
   - Удаление устройства (`IoDeleteDevice`) и символической ссылки (`IoDeleteSymbolicLink`) происходит при выгрузке драйвера или при ошибке инициализации.

---

#### **Жизненный цикл пользовательского приложения**

1. **Инициализация приложения**:
   - Приложение открывает дескриптор к устройству с помощью `CreateFile`.
   - Если устройство недоступно, выводится ошибка, и приложение завершается.

2. **Работа приложения**:
   - Постоянный цикл взаимодействия с драйвером.
   - Проверка готовности передатчика через `DeviceIoControl` с кодом `IOCTL_CHECK_TRANSMITTER_READY`.
   - Если передатчик готов:
     - Отправляется байт на последовательный порт через `DeviceIoControl` с кодом `IOCTL_WRITE_BYTE_TO_PORT`.
   - Если передатчик не готов, происходит ожидание перед следующей проверкой.

3. **Завершение приложения**:
   - Дескриптор устройства закрывается вызовом `CloseHandle`.
   - Приложение завершает выполнение.